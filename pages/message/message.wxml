<!--pages/message/message.wxml-->
<view class="container">
  <!-- 背景音乐组件 -->
  <bgm></bgm>
  <!-- 返回首页按钮 -->
  <home-btn></home-btn>
  
  <!-- 页面标题 -->
  <view class="page-header">
    <view class="title"></view>
    <view class="subtitle"></view>
  </view>
  
  <!-- 留言列表 - 三排自动滚动 -->
  <view class="message-list-container">
    <view class="list-header">
      <view class="list-title">祝福留言</view>
      <view class="list-count">共{{messages.length}}条</view>
    </view>
    
    <!-- 第一排留言 -->
    <view class="message-row">
      <view class="message-item" wx:for="{{messages}}" wx:key="id" wx:if="{{index % 3 === 0}}">
        <view class="message-avatar">
          <image wx:if="{{item.avatarUrl}}" class="avatar-image" src="{{item.avatarUrl}}" mode="aspectFill"></image>
          <text wx:else class="avatar-text">{{item.avatarText}}</text>
        </view>
        
        <view class="message-content">
          <view class="message-header">
            <text class="message-name">{{item.displayName}}</text>
            <text class="message-time">{{item.submitTimeStr}}</text>
          </view>
          <view class="message-text">{{item.content}}</view>
        </view>
      </view>
    </view>
    
    <!-- 第二排留言 -->
    <view class="message-row">
      <view class="message-item" wx:for="{{messages}}" wx:key="id" wx:if="{{index % 3 === 1}}">
        <view class="message-avatar">
          <image wx:if="{{item.avatarUrl}}" class="avatar-image" src="{{item.avatarUrl}}" mode="aspectFill"></image>
          <text wx:else class="avatar-text">{{item.avatarText}}</text>
        </view>
        
        <view class="message-content">
          <view class="message-header">
            <text class="message-name">{{item.displayName}}</text>
            <text class="message-time">{{item.submitTimeStr}}</text>
          </view>
          <view class="message-text">{{item.content}}</view>
        </view>
      </view>
    </view>
    
    <!-- 第三排留言 -->
    <view class="message-row">
      <view class="message-item" wx:for="{{messages}}" wx:key="id" wx:if="{{index % 3 === 2}}">
        <view class="message-avatar">
          <image wx:if="{{item.avatarUrl}}" class="avatar-image" src="{{item.avatarUrl}}" mode="aspectFill"></image>
          <text wx:else class="avatar-text">{{item.avatarText}}</text>
        </view>
        
        <view class="message-content">
          <view class="message-header">
            <text class="message-name">{{item.displayName}}</text>
            <text class="message-time">{{item.submitTimeStr}}</text>
          </view>
          <view class="message-text">{{item.content}}</view>
        </view>
      </view>
    </view>
  </view>

  <!-- 加载更多 -->
  <view class="load-more" wx:if="{{hasMore}}">
    <button class="btn-secondary" bindtap="loadMore" loading="{{loading}}">
      加载更多留言
    </button>
  </view>

  <!-- 空状态 -->
  <view class="empty-state" wx:if="{{messages.length === 0 && !loading}}">
    <view class="empty-text">还没有留言，快来写下您的祝福吧！</view>
  </view>

  <!-- 右下角新增留言按钮 -->
  <view class="add-btn" bindtap="showAddMessageModal">
    <text class="add-icon">+</text>
    <text class="add-text">祝福新人</text>
  </view>

  <!-- 新增留言弹窗 -->
  <view class="modal-overlay" wx:if="{{showAddModal}}" bindtap="hideAddMessageModal">
    <view class="modal-content" catchtap="preventClose">
      <view class="modal-header">
        <text class="modal-title">把您想说的话留在这里</text>
        <text class="modal-close" bindtap="hideAddMessageModal">×</text>
      </view>
      
      <view class="modal-body">
        <view class="form-group">
          <text class="form-label">您的姓名（可选）</text>
          <input class="form-input" placeholder="请输入您的姓名" value="{{formData.name}}" bindinput="onNameInput" maxlength="20" />
        </view>
        
        <view class="form-group">
          <text class="form-label">祝福内容</text>
          <textarea class="form-textarea" placeholder="写下您对新人的祝福..." value="{{formData.content}}" bindinput="onContentInput" maxlength="200" auto-height></textarea>
          <view class="char-count">{{formData.content.length}}/200</view>
        </view>
      </view>
      
      <view class="modal-footer">
        <button class="btn-secondary" bindtap="hideAddMessageModal">取消</button>
        <button class="btn-primary" bindtap="submitMessage" loading="{{submitting}}">发送祝福</button>
      </view>
    </view>
  </view>
</view> 