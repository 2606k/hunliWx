# BGM跨页面同步功能测试用例

## 测试场景

### 测试用例1：基本播放状态同步
**预期行为**：
1. 在首页点击BGM按钮暂停音乐
2. 切换到其他页面（留言、相册、故事）
3. 所有页面的BGM按钮都应该显示暂停状态
4. 音乐应该保持暂停状态

**测试步骤**：
1. 打开小程序，进入首页
2. 确认BGM正在播放（图标旋转）
3. 点击BGM按钮暂停音乐
4. 切换到留言页面，确认BGM按钮显示暂停状态
5. 切换到相册页面，确认BGM按钮显示暂停状态
6. 切换到故事页面，确认BGM按钮显示暂停状态
7. 返回首页，确认BGM按钮仍显示暂停状态

### 测试用例2：恢复播放状态同步
**预期行为**：
1. 在任意页面点击BGM按钮恢复播放
2. 切换到其他页面，所有页面的BGM按钮都应该显示播放状态
3. 音乐应该继续播放

**测试步骤**：
1. 在首页暂停BGM
2. 切换到留言页面
3. 在留言页面点击BGM按钮恢复播放
4. 切换到相册页面，确认BGM按钮显示播放状态
5. 切换到故事页面，确认BGM按钮显示播放状态
6. 返回首页，确认BGM按钮显示播放状态

### 测试用例3：音乐切换状态同步
**预期行为**：
1. 当一首歌播放完毕自动切换到下一首时
2. 所有页面的BGM组件都应该同步显示当前播放的歌曲信息

**测试步骤**：
1. 确保BGM正在播放
2. 等待当前歌曲播放完毕
3. 观察所有页面的BGM状态是否同步更新

### 测试用例4：页面切换性能测试
**预期行为**：
1. 快速切换页面时不应该出现多个音频实例
2. 页面切换应该流畅，无卡顿
3. 内存使用应该保持稳定

**测试步骤**：
1. 快速在多个页面间切换
2. 观察控制台是否有错误信息
3. 检查是否有重复的音频实例创建

## 预期结果

所有测试用例都应该通过，实现以下功能：
- ✅ 跨页面播放状态同步
- ✅ 单例音频实例管理
- ✅ 流畅的页面切换体验
- ✅ 正确的资源清理

## 技术实现说明

### 架构设计
```
App (全局)
├── BGMManager (单例)
│   ├── audioContext (唯一音频实例)
│   ├── isPlaying (全局播放状态)
│   ├── currentMusicIndex (当前歌曲索引)
│   └── listeners (状态监听器集合)
└── Pages
    └── BGM Components (多个实例)
        ├── 监听全局状态变化
        ├── 同步显示播放状态
        └── 调用全局管理器方法
```

### 关键特性
1. **单例模式**：全局只有一个音频实例
2. **观察者模式**：多个BGM组件监听全局状态
3. **状态同步**：所有组件实时同步播放状态
4. **资源管理**：正确的监听器注册和清理

@author tangxin
